# feems in Docker

This is a Docker-based implementation of [feems](https://github.com/NovembreLab/feems). 
Feems, or Fast Estimation of Effective Migration Surfaces, is a Python package for studying gene-flow in spatial population genetic data. 
This Docker version is designed for minimal setup and cross-platform compatibility.

## Getting Started

To get feems running, clone this repository to your local machine, navigate to the cloned directory and execute `make run`. 
This command creates a Docker container with all the necessary requirements, and starts a bash shell with the feems environment.

## Table of Contents

- [About FEEMS](#about-feems)
- [Folder Structure](#folder-structure)
- [Running feems](#running-feems)
  - [Prerequisites](#prerequisites)
  - [Using the Makefile](#using-the-makefile)
  - [Working with Mounted Directory](#working-with-mounted-directory)
- [Toy Example](#toy-example)
  - [How to Run the Toy Example](#how-to-run-the-toy-example)

## About FEEMS

The `feems` method and software was developed by Joe Marcus and Wooseok Ha and
advised by Rina Foygel Barber and John Novembre. We also used code from Benjamin M. Peter
to help construct the spatial graphs.

For details on the method see our [paper](https://elifesciences.org/articles/61927). 

## Folder structure
- [docs](https://github.com/LukeAndersonTrocme/feems/tree/main/docs) contains example jupyter notebooks and additional documentation
- [feems](https://github.com/LukeAndersonTrocme/feems/tree/main/feems) contains the feems source code
  - [feems/data](https://github.com/LukeAndersonTrocme/feems/tree/main/feems/data) contains test data

## Running FEEMS

### Prerequisites

Before you can run feems, ensure that you have the following installed:

- [Docker and docker-compose](https://docs.docker.com/get-docker/): These tools allow you to create and manage Docker containers.
- [Make](https://www.gnu.org/software/make/): This build automation tool helps to manage and build the project. Windows users can install it via [choco](https://community.chocolatey.org/packages/make).

### Using the Makefile

The included Makefile simplifies the process of building and running the Docker container. Use the following command to start the project:

```sh
make run
```
> This command builds the Docker container and starts a shell session with the feems environment activated.

### Working with Mounted Directory

Docker provides a feature called volumes that allow for persistent or shared data among containers. By mounting a directory from the host to the container, any data generated by feems will be saved on your host machine. This is particularly useful to save results, logs, or any other output data that feems might generate.

By default, the project is set up to mount the /feems directory in the container. This means that any file you create or modify in the /feems directory of the container will be mirrored on your host machine, and vice versa.

## Toy Example

This project includes a toy example script ([run_feems_example.py](https://github.com/LukeAndersonTrocme/feems/blob/main/feems/run_feems_example.py)) that illustrates the basics of running a feems analysis using provided test data. You can find the test data in the [feems/data](https://github.com/LukeAndersonTrocme/feems/tree/main/feems/data) directory.

This example works with a dataset of wolf populations, performing the following actions:

1. It loads genotype data from the sample dataset.

2. Sets up a spatial graph using sample coordinates and the outer coordinates representing a habitat.

3. Visualizes the spatial graph, displaying samples, edges, and observed nodes on a map.

4. Estimates the migration surface and visualizes the results.

The visualization output is saved as PNG files in the `output` directory.

You can use this script as a template for your own analyses. Just replace the dataset and tweak parameters as necessary to suit your specific needs.

### How to Run the Toy Example

To run the toy example, navigate to the project directory in your terminal and type:

```sh
python run_feems_example.py
```

The script will execute and produce two output images: map.png and mig_surface.png in the output directory.

